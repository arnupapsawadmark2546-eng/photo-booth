<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MILKBOX STUDIO</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Kanit:wght@300;400;600&display=swap');

    body {
      font-family: 'Inter', 'Kanit', sans-serif; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÑ‡∏ó‡∏¢ Kanit */
      background-color: #fafafa;
      color: #333;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    /* --- Modals (Popup) --- */
    
    /* 1. Popup ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (Welcome) */
    #welcomeModal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(5px);
      z-index: 9999;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      transition: opacity 0.5s ease;
    }
    
    /* 2. Popup ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏´‡∏•‡∏±‡∏á‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏™‡∏£‡πá‡∏à (Instruction) */
    #instructionModal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(255, 255, 255, 0.85); /* ‡∏Ç‡∏≤‡∏ß‡∏à‡∏≤‡∏á‡πÜ */
      backdrop-filter: blur(4px);
      z-index: 9998; /* ‡∏£‡∏≠‡∏á‡∏•‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å Welcome */
      display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô */
      flex-direction: column;
      justify-content: center;
      align-items: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .modal-content {
      padding: 30px;
      border-radius: 24px;
      max-width: 85%;
      background: #fff;
      box-shadow: 0 20px 60px rgba(0,0,0,0.15);
      position: relative;
      text-align: center;
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î Popup (X) */
    .close-modal-btn {
        position: absolute;
        top: 15px; right: 20px;
        font-size: 24px;
        cursor: pointer;
        color: #999;
        background: none;
        border: none;
    }

    .modal-title {
      font-size: 32px;
      font-weight: 900;
      letter-spacing: 2px;
      margin-bottom: 5px;
      color: #000;
    }

    .modal-subtitle {
      font-size: 12px;
      color: #666;
      margin-bottom: 30px;
      letter-spacing: 1px;
    }

    .instruction-text {
        font-size: 16px;
        color: #333;
        line-height: 1.6;
        margin-bottom: 25px;
        font-weight: 400;
    }

    .start-btn {
      padding: 14px 40px;
      font-size: 16px;
      font-weight: bold;
      color: white;
      background: #000;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
      transition: transform 0.2s;
    }
    .start-btn:active { transform: scale(0.95); }

    /* --- ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ --- */
    .app-title-box { text-align: center; margin-bottom: 25px; }
    .main-title { font-weight: 800; font-size: 24px; letter-spacing: 2px; margin: 0; color: #000; }
    .sub-title { font-weight: 400; font-size: 12px; color: #666; letter-spacing: 1px; margin-top: 5px; }

    /* ‡∏Å‡∏•‡πâ‡∏≠‡∏á */
    .camera-wrapper {
      position: relative;
      width: 100%;
      max-width: 350px;
      margin-bottom: 20px;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 15px 40px rgba(0,0,0,0.1);
      background: #000;
      aspect-ratio: 3/4;
    }
    video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }

    /* Overlay ‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á */
    #cameraOverlay {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.3);
      color: white;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
    }
    #cameraOverlay.active { opacity: 1; }
    #countdownNum { font-size: 80px; font-weight: 800; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
    #photoCounterText {
      font-size: 16px; font-weight: 600;
      background: rgba(255,255,255,0.2);
      padding: 5px 15px; border-radius: 20px; margin-top: 10px;
    }

    /* Controls */
    .control-group {
      background: white; padding: 12px; border-radius: 16px;
      width: 100%; max-width: 360px; margin-bottom: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04); text-align: center;
    }
    .label { font-size: 10px; color: #aaa; margin-bottom: 6px; display: block; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }

    .option-btn {
      border: 1px solid transparent; padding: 8px 12px; margin: 2px;
      border-radius: 10px; font-size: 12px; cursor: pointer;
      background: #f4f4f4; color: #666; transition: all 0.2s ease;
    }
    .option-btn.active { background: #222; color: #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }

    .main-controls {
        display: flex; align-items: center; justify-content: center;
        gap: 15px; margin: 20px 0;
    }

    /* ‡∏õ‡∏∏‡πà‡∏° Auto Snap (‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏õ‡πä‡∏∞) */
    .auto-snap-btn {
      width: 80px; height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ff6b6b, #ee5253);
      border: 4px solid #fff;
      box-shadow: 0 10px 25px rgba(238, 82, 83, 0.4);
      cursor: pointer;
      display: flex;
      justify-content: center; /* ‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡∏Å‡∏•‡∏≤‡∏á */
      align-items: center;     /* ‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏Å‡∏•‡∏≤‡∏á */
      text-align: center;
      color: white;
      font-weight: bold;
      font-size: 14px;
      line-height: 1.2;
      text-transform: uppercase;
      transition: transform 0.1s;
    }
    .auto-snap-btn:active { transform: scale(0.95); }
    .auto-snap-btn.capturing { background: #ccc; box-shadow: none; pointer-events: none; font-size: 12px; }

    .icon-btn {
        background: white; border: none; width: 50px; height: 50px;
        border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        cursor: pointer; color: #333; font-size: 20px; transition: 0.2s;
    }
    .icon-btn:hover { background: #f0f0f0; }

    input[type="text"] {
      border: none; background: #fff; padding: 15px; border-radius: 12px;
      width: 100%; max-width: 300px; text-align: center;
      font-family: inherit; outline: none; box-shadow: 0 4px 15px rgba(0,0,0,0.03);
      margin-bottom: 20px;
    }

    #photos { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; min-height: 60px; }
    #photos img { width: 60px; height: 60px; object-fit: cover; border-radius: 10px; transform: scaleX(-1); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }

    #frame { display: flex; flex-direction: column; align-items: center; }
    #frame img { max-width: 100%; width: 340px; border-radius: 4px; box-shadow: 0 20px 60px rgba(0,0,0,0.2); }

    .final-actions { display: flex; gap: 10px; margin-top: 20px; margin-bottom: 50px; }
    .action-button {
        padding: 12px 24px; border-radius: 30px; text-decoration: none;
        font-weight: 600; font-size: 14px; display: flex; align-items: center;
        gap: 8px; cursor: pointer; border: none; transition: 0.2s;
    }
    .dl-btn { background: #000; color: white; }
    .share-btn { background: #fff; color: #333; border: 1px solid #ddd; }
    
    body.is-capturing .control-group,
    body.is-capturing input,
    body.is-capturing #photos,
    body.is-capturing .icon-btn { opacity: 0.5; pointer-events: none; }
  </style>
</head>
<body>

<div id="welcomeModal">
  <div class="modal-content">
    <div class="modal-title">MILKBOX</div>
    <div class="modal-subtitle">BY IG MARKENZ9</div>
    <div style="font-size: 14px; color:#444; margin-bottom: 30px; line-height: 1.6;">
        Select Layout ‚Ä¢ Choose Filter ‚Ä¢ Auto Snap<br>
        ‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û
    </div>
    <button class="start-btn" onclick="closeModalAndStart()">TOUCH TO START</button>
  </div>
</div>

<div id="instructionModal">
  <div class="modal-content" style="max-width: 300px;">
    <button class="close-modal-btn" onclick="closeInstruction()">&times;</button>
    <div style="font-size: 40px; margin-bottom: 10px;">‚ú®</div>
    <h3 style="margin: 0 0 10px 0;">‡∏£‡∏π‡∏õ‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß!</h3>
    <div class="instruction-text">
        ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏Ñ‡∏õ‡∏ä‡∏±‡πà‡∏ô<br>‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏Å‡∏£‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡πÉ‡∏à‡∏ä‡∏≠‡∏ö<br>‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏¢
    </div>
    <button class="start-btn" onclick="closeInstruction()" style="background: #333; padding: 10px 30px; font-size: 14px;">‡πÇ‡∏≠‡πÄ‡∏Ñ ‡∏•‡∏∏‡∏¢‡πÄ‡∏•‡∏¢!</button>
  </div>
</div>


<div class="app-title-box">
    <h1 class="main-title">MILKBOX</h1>
    <div class="sub-title">BY IG MARKENZ9</div>
</div>

<div class="camera-wrapper">
  <video id="video" autoplay playsinline></video>
  <div id="cameraOverlay">
      <div id="countdownNum">3</div>
      <div id="photoCounterText">Photo 1/4</div>
  </div>
</div>

<div class="control-group">
  <span class="label">Layout</span>
  <button id="layout3" onclick="setLayout(3, this)" class="option-btn">Strip (3)</button>
  <button id="layout4" onclick="setLayout(4, this)" class="option-btn active">Grid (4)</button>
  <button id="layout6" onclick="setLayout(6, this)" class="option-btn">Big (6)</button>
</div>

<div class="control-group">
  <span class="label">Tone</span>
  <button onclick="setFilter('none', this)" class="option-btn active">Normal</button>
  <button onclick="setFilter('brightness(1.15) saturate(0.9) contrast(0.95)', this)" class="option-btn">üá∞üá∑ Soft</button>
  <button onclick="setFilter('brightness(1.1) contrast(1.15) sepia(0.2)', this)" class="option-btn">üáØüáµ Film</button>
  <button onclick="setFilter('brightness(1.2) contrast(1.05) grayscale(1)', this)" class="option-btn">‚òÅÔ∏è Mono</button>
</div>

<div class="control-group">
  <span class="label">Frame</span>
  <button onclick="setFrameColor('#ffffff', '#000000', this)" class="option-btn active">White</button>
  <button onclick="setFrameColor('#1a1a1a', '#ffffff', this)" class="option-btn" style="background:#333; color:#fff;">Black</button>
  <button onclick="setFrameColor('#FADADD', '#C2185B', this)" class="option-btn" style="background:#FADADD; color:#C2185B;">Pink</button>
  <button onclick="setFrameColor('#E3F2FD', '#1565C0', this)" class="option-btn" style="background:#E3F2FD; color:#1565C0;">Blue</button>
</div>

<div class="main-controls">
  <div id="autoSnapBtn" class="auto-snap-btn" onclick="startAutoCapture()">
      AUTO<br>SNAP
  </div>
  <button onclick="resetApp()" class="icon-btn" title="Reset"><i class="fas fa-redo"></i></button>
</div>

<input id="captionInput" type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." oninput="updateCaption()">

<div id="photos"></div>
<div id="frame"></div>

<script>
  const video = document.getElementById("video");
  const photosDiv = document.getElementById("photos");
  const frameDiv = document.getElementById("frame");
  const captionInput = document.getElementById("captionInput");
  const cameraOverlay = document.getElementById("cameraOverlay");
  const countdownNum = document.getElementById("countdownNum");
  const photoCounterText = document.getElementById("photoCounterText");
  const autoSnapBtn = document.getElementById("autoSnapBtn");
  const welcomeModal = document.getElementById("welcomeModal");
  const instructionModal = document.getElementById("instructionModal");

  let photos = [];
  let maxPhotos = 4; 
  let currentLayout = 4;
  let currentFilter = 'none';
  let frameBg = '#ffffff';
  let frameText = '#000000';
  let isCapturing = false;
  let hasShownInstruction = false; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏¢‡πÇ‡∏ä‡∏ß‡πå‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÑ‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á

  // 1. ‡∏õ‡∏¥‡∏î Welcome Popup
  function closeModalAndStart() {
    welcomeModal.style.opacity = '0';
    setTimeout(() => {
        welcomeModal.style.display = 'none';
        startCamera();
    }, 500);
  }

  // 2. ‡∏õ‡∏¥‡∏î Instruction Popup
  function closeInstruction() {
      instructionModal.style.opacity = '0';
      setTimeout(() => {
          instructionModal.style.display = 'none';
      }, 300);
  }

  // 3. ‡πÅ‡∏™‡∏î‡∏á Instruction Popup (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏™‡∏£‡πá‡∏à)
  function showInstruction() {
      if(hasShownInstruction) return; // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏¢‡πÇ‡∏ä‡∏ß‡πå‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏ä‡∏ß‡πå‡∏ã‡πâ‡∏≥
      
      instructionModal.style.display = 'flex';
      // ‡πÉ‡∏ä‡πâ setTimeout ‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡πÉ‡∏´‡πâ Animation ‡∏™‡∏ß‡∏¢
      setTimeout(() => {
          instructionModal.style.opacity = '1';
      }, 100);
      
      hasShownInstruction = true;
  }

  function startCamera() {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
      alert("Browser ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô HTTPS");
      return;
    }
    navigator.mediaDevices.getUserMedia({ 
      video: { width: { ideal: 1280 }, height: { ideal: 720 }, facingMode: "user" } 
    }).then(stream => { 
      video.srcObject = stream; video.play();
    }).catch(err => {
      console.error(err); alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î '‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï (Allow)' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á");
    });
  }

  function startAutoCapture() {
    if (isCapturing) return;
    if (!video.srcObject) { startCamera(); return; }
    
    resetApp(false); 
    isCapturing = true;
    document.body.classList.add('is-capturing');
    autoSnapBtn.classList.add('capturing');
    autoSnapBtn.innerHTML = "STOP"; 
    runCaptureSequence(0);
  }

  function runCaptureSequence(index) {
    if (index >= maxPhotos) {
        finishAutoCapture();
        return;
    }

    photoCounterText.innerText = `Photo ${index + 1}/${maxPhotos}`;
    cameraOverlay.classList.add('active');

    let count = 3;
    countdownNum.innerText = count;
    
    const countdownTimer = setInterval(() => {
        count--;
        if (count > 0) {
            countdownNum.innerText = count;
        } else {
            clearInterval(countdownTimer);
            countdownNum.innerText = "CHEESE!";
            setTimeout(() => {
                takePhoto(true); 
                cameraOverlay.classList.remove('active'); 
                setTimeout(() => { runCaptureSequence(index + 1); }, 1500); 
            }, 500);
        }
    }, 1000);
  }

  function finishAutoCapture() {
    isCapturing = false;
    document.body.classList.remove('is-capturing');
    autoSnapBtn.classList.remove('capturing');
    autoSnapBtn.innerHTML = "AUTO<br>SNAP";
    
    // üî¥ ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏™‡∏£‡πá‡∏à‡∏õ‡∏∏‡πä‡∏ö ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡πÄ‡∏•‡∏¢ + ‡πÇ‡∏ä‡∏ß‡πå‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
    createFrame();
    showInstruction();
  }

  function takePhoto(isAuto = false) {
    if (photos.length >= maxPhotos) return;
    if (!isAuto && isCapturing) return; 

    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth; canvas.height = video.videoHeight;
    const ctx = canvas.getContext("2d");

    ctx.filter = currentFilter; 
    ctx.translate(canvas.width, 0); ctx.scale(-1, 1);
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    ctx.filter = 'none'; 

    const imgData = canvas.toDataURL("image/png");
    photos.push(imgData);

    const thumb = document.createElement("img");
    thumb.src = imgData; photosDiv.appendChild(thumb);

    // ‡∏ñ‡πâ‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö Manual ‡∏à‡∏ô‡∏Ñ‡∏£‡∏ö ‡∏Å‡πá‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡πÄ‡∏•‡∏¢‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô
    if (!isCapturing && photos.length === maxPhotos) {
      createFrame();
      showInstruction();
    }
  }

  // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Layout / Filter / Frame ---
  function setLayout(num, btn) {
    if (isCapturing) return;
    if (photos.length > 0 && !confirm("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Layout ‡∏£‡∏π‡∏õ‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡∏ô‡∏∞ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÑ‡∏´‡∏°?")) return;
    resetApp();
    maxPhotos = num; currentLayout = num;
    document.querySelectorAll('#layout3, #layout4, #layout6').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
  }

  function setFilter(val, btn) {
    currentFilter = val; video.style.filter = val;
    if(btn) {
      btn.parentElement.querySelectorAll('.option-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    }
  }

  function setFrameColor(bg, txt, btn) {
    frameBg = bg; frameText = txt;
    if(btn) {
      btn.parentElement.querySelectorAll('.option-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    }
    if (photos.length === maxPhotos) createFrame();
  }

  function updateCaption() {
    if (photos.length === maxPhotos) createFrame();
  }

  function resetApp(clearCaption = true) {
    if(isCapturing) return;
    photos = []; photosDiv.innerHTML = ""; frameDiv.innerHTML = "";
    if(clearCaption) captionInput.value = "";
    hasShownInstruction = false; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏ß‡πå‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å‡∏ñ‡πâ‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà
  }

  // --- ‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ ---
  function createFrame() {
    frameDiv.innerHTML = "";
    // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏≠‡∏∞‡πÑ‡∏£ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á (‡πÅ‡∏ï‡πà‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏∞‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≠‡∏ö‡∏£‡∏≠‡πÑ‡∏ß‡πâ‡πÄ‡∏•‡∏¢)
    const caption = captionInput.value || "";
    
    const frameCanvas = document.createElement("canvas");
    const fctx = frameCanvas.getContext("2d");
    const padding = 50; const gap = 20; const bottomSpace = 160;

    const images = []; let loaded = 0;
    photos.forEach((src, i) => {
      const img = new Image(); img.src = src;
      img.onload = () => {
        images[i] = img; loaded++;
        if (loaded === maxPhotos) draw();
      };
    });

    function draw() {
      const w = images[0].width; const h = images[0].height;
      let canvasW, canvasH;

      if (currentLayout === 3) {
        canvasW = w + (padding * 2); canvasH = (h * 3) + (gap * 2) + (padding * 2) + bottomSpace;
      } else if (currentLayout === 4) {
        canvasW = (w * 2) + gap + (padding * 2); canvasH = (h * 2) + gap + (padding * 2) + bottomSpace;
      } else if (currentLayout === 6) {
        canvasW = (w * 2) + gap + (padding * 2); canvasH = (h * 3) + (gap * 2) + (padding * 2) + bottomSpace;
      }

      frameCanvas.width = canvasW; frameCanvas.height = canvasH;

      fctx.fillStyle = frameBg; fctx.fillRect(0, 0, canvasW, canvasH);

      images.forEach((img, i) => {
        let x, y;
        if (currentLayout === 3) { x = padding; y = padding + i * (h + gap); }
        else if (currentLayout === 4) { x = padding + (i%2)*(w+gap); y = padding + Math.floor(i/2)*(h+gap); }
        else if (currentLayout === 6) { x = padding + (i%2)*(w+gap); y = padding + Math.floor(i/2)*(h+gap); }
        fctx.drawImage(img, x, y, w, h);
      });

      fctx.fillStyle = frameText; fctx.font = "800 52px 'Inter', sans-serif";
      fctx.textAlign = "center"; fctx.fillText(caption, canvasW / 2, canvasH - 90);

      fctx.font = "400 24px 'Inter', sans-serif";
      fctx.fillText(new Date().toLocaleDateString('en-GB'), canvasW / 2, canvasH - 40);

      fctx.save(); fctx.globalAlpha = 0.4; fctx.font = "600 16px 'Inter', sans-serif"; 
      fctx.fillStyle = frameText; fctx.textAlign = "right"; fctx.letterSpacing = "1px";
      fctx.fillText("MILKBOX BY IG MARKENZ9", canvasW - (padding/2), canvasH - (padding/2));
      fctx.restore();

      const finalImage = document.createElement("img");
      const finalImageDataURL = frameCanvas.toDataURL("image/png");
      finalImage.src = finalImageDataURL;
      frameDiv.appendChild(finalImage);

      const actionContainer = document.createElement("div");
      actionContainer.className = "final-actions";

      const dlBtn = document.createElement("a");
      dlBtn.href = finalImageDataURL; dlBtn.download = "milkbox-studio.png";
      dlBtn.className = "action-button dl-btn";
      dlBtn.innerHTML = '<i class="fas fa-download"></i> Save Image';
      
      // üî¥ ‡∏õ‡∏∏‡πà‡∏° Share ‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏ö‡∏•‡∏¥‡πâ‡∏á‡∏Ñ‡πå‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢
      const shareBtn = document.createElement("button");
      shareBtn.className = "action-button share-btn";
      shareBtn.innerHTML = '<i class="fas fa-share-alt"></i> Share';
      shareBtn.onclick = async () => {
          try {
              const blob = await (await fetch(finalImageDataURL)).blob();
              const file = new File([blob], "milkbox-share.png", { type: blob.type });

              // ‡∏î‡∏∂‡∏á URL ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô‡πÅ‡∏ä‡∏£‡πå
              const currentUrl = window.location.href;

              if (navigator.share) {
                  await navigator.share({
                      title: 'My MILKBOX Photo',
                      text: `‡∏°‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÄ‡∏Å‡πã‡πÜ ‡∏ó‡∏µ‡πà MILKBOX ‡∏Å‡∏±‡∏ô! üì∏‚ú® ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏•‡∏¢‡∏ó‡∏µ‡πà: ${currentUrl}`,
                      url: currentUrl, // ‡∏ö‡∏≤‡∏á Browser ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ
                      files: [file],
                  });
              } else {
                  alert("Browser ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á");
              }
          } catch (error) {
              console.error("Error sharing:", error);
          }
      };

      actionContainer.appendChild(dlBtn);
      if (navigator.canShare && navigator.canShare({ files: [new File([], 'test.png', {type:'image/png'})] })) {
          actionContainer.appendChild(shareBtn);
      }

      frameDiv.appendChild(actionContainer);
      
      // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏à‡∏≠‡∏•‡∏á‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
      frameDiv.scrollIntoView({ behavior: 'smooth' });
    }
  }
</script>

</body>
</html>
