<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Photo Booth</title>
  <style>
    body {
      font-family: Arial;
      background: #f5f5f5;
      text-align: center;
    }
    video {
      width: 300px;
      border-radius: 12px;
    }
    button {
      padding: 12px 24px;
      font-size: 16px;
      margin: 10px;
    }
    #countdown {
      font-size: 48px;
      color: #ff4d4d;
      margin: 10px;
    }
    canvas {
      display: none;
    }
    #frame {
      margin-top: 20px;
    }
  </style>
</head>
<body>

<h2>üì∏ Korean Photo Booth</h2>

<div id="countdown"></div>
<video id="video" autoplay></video><br>

<button onclick="startBooth()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ñ‡πà‡∏≤‡∏¢</button>

<canvas id="canvas"></canvas>

<div id="frame"></div>

<script>
  const video = document.getElementById("video");
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  const countdownEl = document.getElementById("countdown");
  const frameDiv = document.getElementById("frame");

  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => video.srcObject = stream);

  let photos = [];

  function startBooth() {
    photos = [];
    frameDiv.innerHTML = "";
    takeWithCountdown(4);
  }

  function takeWithCountdown(remaining) {
    if (remaining === 0) {
      createFrame();
      return;
    }

    let count = 3;
    countdownEl.innerText = count;

    const timer = setInterval(() => {
      count--;
      if (count === 0) {
        clearInterval(timer);
        countdownEl.innerText = "üì∏";
        takePhoto();
        setTimeout(() => {
          countdownEl.innerText = "";
          takeWithCountdown(remaining - 1);
        }, 800);
      } else {
        countdownEl.innerText = count;
      }
    }, 1000);
  }

  function takePhoto() {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0);
    photos.push(canvas.toDataURL("image/png"));
  }

  function createFrame() {
  const frameCanvas = document.createElement("canvas");
  const fctx = frameCanvas.getContext("2d");

  const img = new Image();
  img.src = photos[0];

  img.onload = () => {
    const w = img.width;
    const h = img.height;
    const padding = 40; // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏Å‡∏£‡∏≠‡∏ö

    frameCanvas.width = w * 2 + padding * 3;
    frameCanvas.height = h * 2 + padding * 3 + 60;

    // ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏ß
    fctx.fillStyle = "#ffffff";
    fctx.fillRect(0, 0, frameCanvas.width, frameCanvas.height);

    photos.forEach((src, i) => {
      const image = new Image();
      image.src = src;
      image.onload = () => {
        const x = padding + (i % 2) * (w + padding);
        const y = padding + Math.floor(i / 2) * (h + padding);
        fctx.drawImage(image, x, y, w, h);
      };
    });

    // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
    fctx.fillStyle = "#000";
    fctx.font = "24px Arial";
    fctx.textAlign = "center";
    fctx.fillText(
      "KOREAN PHOTO BOOTH",
      frameCanvas.width / 2,
      frameCanvas.height - 20
    );

    setTimeout(() => {
      const resultImg = document.createElement("img");
      resultImg.src = frameCanvas.toDataURL("image/png");
      resultImg.style.width = "300px";
      frameDiv.appendChild(resultImg);

      const link = document.createElement("a");
      link.href = resultImg.src;
      link.download = "photo-booth.png";
      link.innerText = "‚¨áÔ∏è ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ";
      frameDiv.appendChild(document.createElement("br"));
      frameDiv.appendChild(link);
    }, 500);
  };
}
  
</script>

</body>
</html>
