<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Photo Booth</title>
  <style>
    body {
      font-family: Arial;
      background: #f5f5f5;
      text-align: center;
    }
    video {
      width: 300px;
      border-radius: 12px;
    }
    button {
      padding: 12px 24px;
      font-size: 16px;
      margin: 10px;
    }
    #countdown {
      font-size: 48px;
      color: #ff4d4d;
      margin: 10px;
    }
    canvas {
      display: none;
    }
    #frame {
      margin-top: 20px;
    }
  </style>
</head>
<body>

<h2>ðŸ“¸ Korean Photo Booth</h2>

<div id="countdown"></div>
<video id="video" autoplay></video><br>

<button onclick="startBooth()">à¹€à¸£à¸´à¹ˆà¸¡à¸–à¹ˆà¸²à¸¢</button>

<canvas id="canvas"></canvas>

<div id="frame"></div>

<script>
  const video = document.getElementById("video");
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  const countdownEl = document.getElementById("countdown");
  const frameDiv = document.getElementById("frame");

  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => video.srcObject = stream);

  let photos = [];

  function startBooth() {
    photos = [];
    frameDiv.innerHTML = "";
    takeWithCountdown(4);
  }

  function takeWithCountdown(remaining) {
    if (remaining === 0) {
      createFrame();
      return;
    }

    let count = 3;
    countdownEl.innerText = count;

    const timer = setInterval(() => {
      count--;
      if (count === 0) {
        clearInterval(timer);
        countdownEl.innerText = "ðŸ“¸";
        takePhoto();
        setTimeout(() => {
          countdownEl.innerText = "";
          takeWithCountdown(remaining - 1);
        }, 800);
      } else {
        countdownEl.innerText = count;
      }
    }, 1000);
  }

  function takePhoto() {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0);
    photos.push(canvas.toDataURL("image/png"));
  }

  function createFrame() {
  frameDiv.innerHTML = "";

  const frameCanvas = document.createElement("canvas");
  const fctx = frameCanvas.getContext("2d");

  const padding = 40;
  const bottomSpace = 80;

  const images = [];
  let loaded = 0;

  // à¹‚à¸«à¸¥à¸”à¸£à¸¹à¸›à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸à¹ˆà¸­à¸™
  photos.forEach((src, i) => {
    const img = new Image();
    img.src = src;
    img.onload = () => {
      images[i] = img;
      loaded++;

      if (loaded === photos.length) {
        drawFrame();
      }
    };
  });

  function drawFrame() {
    const w = images[0].width;
    const h = images[0].height;

    frameCanvas.width = w * 2 + padding * 3;
    frameCanvas.height = h * 2 + padding * 3 + bottomSpace;

    // ðŸ‘‰ à¸à¸£à¸­à¸šà¸‚à¸²à¸§ (à¸žà¸·à¹‰à¸™à¸«à¸¥à¸±à¸‡)
    fctx.fillStyle = "#ffffff";
    fctx.fillRect(0, 0, frameCanvas.width, frameCanvas.height);

    // à¸§à¸²à¸”à¸£à¸¹à¸› 4 à¸£à¸¹à¸›
    images.forEach((img, i) => {
      const x = padding + (i % 2) * (w + padding);
      const y = padding + Math.floor(i / 2) * (h + padding);
      fctx.filter = "contrast(0.9) saturate(0.85) brightness(1.05)";
fctx.drawImage(img, x, y, w, h);
fctx.filter = "none";
      const grain = fctx.getImageData(0, 0, frameCanvas.width, frameCanvas.height);
for (let i = 0; i < grain.data.length; i += 4) {
  const noise = (Math.random() - 0.5) * 12;
  grain.data[i] += noise;     // R
  grain.data[i + 1] += noise; // G
  grain.data[i + 2] += noise; // B
}
fctx.putImageData(grain, 0, 0);
      fctx.fillStyle = "rgba(255, 220, 180, 0.08)";
fctx.fillRect(0, 0, frameCanvas.width, frameCanvas.height);
      
    });

    // à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸¥à¹ˆà¸²à¸‡
    fctx.fillStyle = "#000";
    fctx.font = "24px Arial";
    fctx.textAlign = "center";
    fctx.fillText(
      "Daonuea IN China",
      frameCanvas.width / 2,
      frameCanvas.height - 30
    );

    // à¹à¸ªà¸”à¸‡à¸œà¸¥
    const resultImg = document.createElement("img");
    resultImg.src = frameCanvas.toDataURL("image/png");
    resultImg.style.width = "300px";
    frameDiv.appendChild(resultImg);

    const link = document.createElement("a");
    link.href = resultImg.src;
    link.download = "photo-booth.png";
    link.innerText = "â¬‡ï¸ à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¸£à¸¹à¸›";
    frameDiv.appendChild(document.createElement("br"));
    frameDiv.appendChild(link);
  }
}
  
  
</script>

</body>
</html>
