<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Photo Booth</title>
  <style>
    body {
      font-family: Arial;
      background: #f5f5f5;
      text-align: center;
    }
    video {
      width: 300px;
      border-radius: 12px;
    }
    button {
      padding: 12px 24px;
      font-size: 16px;
      margin: 10px;
    }
    #countdown {
      font-size: 48px;
      color: #ff4d4d;
      margin: 10px;
    }
    canvas {
      display: none;
    }
    #frame {
      margin-top: 20px;
    }
  </style>
</head>
<body>

<h2>üì∏ Korean Photo Booth</h2>

<div id="countdown"></div>
<video id="video" autoplay></video><br>

<button onclick="startBooth()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ñ‡πà‡∏≤‡∏¢</button>

<canvas id="canvas"></canvas>

<div id="frame"></div>

<script>
  const video = document.getElementById("video");
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  const countdownEl = document.getElementById("countdown");
  const frameDiv = document.getElementById("frame");
  const photosDiv = document.getElementById("photos");
const frameDiv = document.getElementById("frame");


  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => video.srcObject = stream);

  let photos = [];

  function startBooth() {
    photos = [];
    frameDiv.innerHTML = "";
    takeWithCountdown(4);
  }

  function takeWithCountdown(remaining) {
    if (remaining === 0) {
      createFrame();
      return;
    }

    let count = 3;
    countdownEl.innerText = count;

    const timer = setInterval(() => {
      count--;
      if (count === 0) {
        clearInterval(timer);
        countdownEl.innerText = "üì∏";
        takePhoto();
        setTimeout(() => {
          countdownEl.innerText = "";
          takeWithCountdown(remaining - 1);
        }, 800);
      } else {
        countdownEl.innerText = count;
      }
    }, 1000);
  }

 function takePhoto() {
  if (video.videoWidth === 0) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô");
    return;
  }

  if (photos.length >= 4) return;

  const canvas = document.createElement("canvas");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;

  const ctx = canvas.getContext("2d");
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  const imgData = canvas.toDataURL("image/png");
  photos.push(imgData);

  // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ñ‡πà‡∏≤‡∏¢
  const thumb = document.createElement("img");
  thumb.src = imgData;
  thumb.style.width = "70px";
  thumb.style.margin = "4px";
  thumb.style.borderRadius = "6px";
  photosDiv.appendChild(thumb);

  // ‡∏Ñ‡∏£‡∏ö 4 ‡∏£‡∏π‡∏õ ‚Üí ‡∏£‡∏ß‡∏°‡∏Å‡∏£‡∏≠‡∏ö
  if (photos.length === 4) {
    createFrame();
  }
}

  if (photos.length >= 4) return;

  const canvas = document.createElement("canvas");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;

  const ctx = canvas.getContext("2d");
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  const imgData = canvas.toDataURL("image/png");
  photos.push(imgData);

  // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ñ‡πà‡∏≤‡∏¢ (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å)
  const thumb = document.createElement("img");
  thumb.src = imgData;
  thumb.style.width = "70px";
  thumb.style.margin = "4px";
  thumb.style.borderRadius = "6px";
  photosDiv.appendChild(thumb);

  // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏£‡∏ö 4 ‡∏£‡∏π‡∏õ ‚Üí ‡∏£‡∏ß‡∏°‡∏Å‡∏£‡∏≠‡∏ö
  if (photos.length === 4) {
    createFrame();
  }
}

  function createFrame() {
  frameDiv.innerHTML = "";

  const caption = document.getElementById("captionInput").value || "";

  const frameCanvas = document.createElement("canvas");
  const fctx = frameCanvas.getContext("2d");

  const padding = 20;
  const bottomSpace = 90;

  const images = [];
  let loaded = 0;

  photos.forEach((src, i) => {
    const img = new Image();
    img.src = src;
    img.onload = () => {
      images[i] = img;
      loaded++;
      if (loaded === 4) draw();
    };
  });

  function draw() {
    const w = images[0].width;
    const h = images[0].height;

    frameCanvas.width = w * 2 + padding * 3;
    frameCanvas.height = h * 2 + padding * 3 + bottomSpace;

    // ‡∏Å‡∏£‡∏≠‡∏ö‡∏Ç‡∏≤‡∏ß
    fctx.fillStyle = "#fff";
    fctx.fillRect(0, 0, frameCanvas.width, frameCanvas.height);

    // ‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ + ‡πÇ‡∏ó‡∏ô
    images.forEach((img, i) => {
      const x = padding + (i % 2) * (w + padding);
      const y = padding + Math.floor(i / 2) * (h + padding);

      if (currentTone === "film") {
        fctx.filter = "contrast(0.9) saturate(0.85) brightness(1.05)";
      } else if (currentTone === "bw") {
        fctx.filter = "grayscale(1) contrast(1.1)";
      } else {
        fctx.filter = "none";
      }

      fctx.drawImage(img, x, y, w, h);
      fctx.filter = "none";
    });

    // caption
    fctx.fillStyle = "#000";
    fctx.font = "22px Arial";
    fctx.textAlign = "center";
    fctx.fillText(
      caption,
      frameCanvas.width / 2,
      frameCanvas.height - 55
    );

    // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ü‡∏¥‡∏•‡πå‡∏°
    fctx.fillStyle = "#666";
    fctx.font = "16px 'Courier New', monospace";
    fctx.fillText(
      getFilmDate(),
      frameCanvas.width / 2,
      frameCanvas.height - 28
    );

    const result = document.createElement("img");
    result.src = frameCanvas.toDataURL("image/png");
    result.style.width = "300px";
    frameDiv.appendChild(result);
  
    const link = document.createElement("a");
    link.href = resultImg.src;
    link.download = "photo-booth.png";
    link.innerText = "‚¨áÔ∏è ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ";
    frameDiv.appendChild(document.createElement("br"));
    frameDiv.appendChild(link);
  }
}
  
  
</script>

</body>
</html>
